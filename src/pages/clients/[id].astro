---
import Base from '../../layouts/Base.astro';
import { getClients } from '../../lib/clients.js';

export async function getStaticPaths() {
  const clients = await getClients();
  return clients.map((client) => ({
    params: { id: client.id },
    props: { client }
  }));
}

const { client } = Astro.props;
const title = `${client.name} | hackernews.hn`;
const description = client.tagline || client.description;
const linkItems = [
  { label: 'Homepage', url: client.homepage_url },
  client.repo_url ? { label: 'Repository', url: client.repo_url } : null,
  client.hn_discussion_url ? { label: 'HN Discussion', url: client.hn_discussion_url } : null
].filter(Boolean);
---

<Base title={title} description={description}>
  <a href="/">‚Üê Back to all clients</a>
  <section class="detail">
    <h1>{client.name}</h1>
    {client.tagline ? <p>{client.tagline}</p> : null}
    <p>{client.description}</p>

    <div class="detail-links">
      {linkItems.map((item) => (
        <a href={item.url} rel="noopener noreferrer" target="_blank">{item.label}</a>
      ))}
    </div>

    <div class="detail-meta">
      <div>
        <strong>Platforms</strong>
        <div class="meta">
          {client.platforms.map((platform) => (
            <span class="tag" key={`${client.id}-${platform}`}>{platform}</span>
          ))}
        </div>
      </div>
      <div>
        <strong>Type</strong>
        <div class="meta">
          <span class="tag">{client.client_type}</span>
        </div>
      </div>
      <div>
        <strong>Price</strong>
        <div class="meta">
          <span class="tag">{client.price}</span>
        </div>
      </div>
      <div>
        <strong>Status</strong>
        <div class="meta">
          <span class="tag">{client.status}</span>
        </div>
      </div>
      <div>
        <strong>Open Source</strong>
        <div class="meta">
          <span class="tag">{client.open_source ? 'yes' : 'no'}</span>
        </div>
      </div>
      {client.tags?.length ? (
        <div>
          <strong>Tags</strong>
          <div class="meta">
            {client.tags.map((tag) => (
              <span class="tag" key={`${client.id}-${tag}`}>{tag}</span>
            ))}
          </div>
        </div>
      ) : null}
      <div>
        <strong>Last Checked</strong>
        <div class="meta">
          <span class="tag">{client.last_checked}</span>
        </div>
      </div>
    </div>
  </section>
</Base>
